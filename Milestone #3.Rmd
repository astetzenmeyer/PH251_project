---
title: 'Milestone #3'
author: "Virginia Chan, Patrick Traynor, Antoinette Stetzenmeyer"
date: "11/4/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#load libraries
library(tidyverse)
library(lubridate)

```


This is the code used to load the two data sets of interest: cox_vax_admin.cvs
and ca_county_demographics.csv. The first 10 rows are provided to provide a 
sample of the variables and values
```{r}

library(readr)
cov_vax_admin <- read_csv("cov_vax_admin.csv")
head(cov_vax_admin)
ca_county_demographics <- read_csv("ca_county_demographics.csv")
head(ca_county_demographics)




```

This is to identify all of the unique dates in the cov_vax_admin.csv data frame.
It shows cumulative totals, that is, prior to, the date provided.
```{r}

unique(cov_vax_admin$as_of_date)

```
We can see that the first date is January 5, 2021 and the final date is September
14, 2021.
\newpage 

# First Task: Subset rows or columns, as needed
```{r}
#Antoinette: Subset cov_vax_admin dataset by county and recent dates (September 2021)
<<<<<<< HEAD
total_age12andabove<- cov_vax_admin %>%
  filter(as_of_date == "9/14/2021") %>%
  group_by(county) %>%
  arrange(county)%>%
  drop_na(county) %>%
summarize(total_age12andabove = sum(age12_plus_population,na.rm = TRUE), 
         persons_fully_vaccinated = sum(persons_fully_vaccinated,na.rm = TRUE))

#sum of age 12+ population per county 
=======

#mutate(cox_vax_admin, county = str_to_title(cov_vax_admin$county) )

total_age12andabove_california_county<- cov_vax_admin %>%
  select(c(as_of_date, zip_code_tabulation_area, county, vaccine_equity_metric_quartile, age12_plus_population, persons_fully_vaccinated)) %>%
  filter(as_of_date ==  "9/7/2021"| as_of_date == "9/14/2021") %>%
  group_by(county) %>%
  arrange(county)%>%
summarize(total_age12andabove = sum(age12_plus_population,na.rm = TRUE), median_of_age_12_and_above = median(age12_plus_population, na.rm = TRUE))
```


```{r}
#Antoinette: Filter by county and total population
ca_county_demographic_totalpop <- ca_county_demographics %>%
  select(c(name, pop2012))
>>>>>>> b6e797b1d8936c83a3d541fb540993d9bd9a0235

```

We would like to answer the question, "By how much has the monthly vaccination 
rate been increasing in LA County as of January 1, 2021?"
First we need to select only pertinent variables (columns). We need the
as_of_date, county, age12_plus_population, persons_fully_vaccinated, persons_partially_vaccinated variables. We also need to filter out all other 
counties but keep Los Angeles. 
```{r}

total_pop <- ca_county_demographics %>%
  select(name, pop2012) %>% 
  mutate(name=str_to_upper(name))

#merge the two datasets 

merged_dataset_pop_vax <- inner_join(total_age12andabove, total_pop, by=c("county"="name"))
```

\newpage 

# Second Task: Create new variables needed for analysis (minimum 2)
New variables should be created based on existing columns; for example
Calculating a rate, 
Combining character strings 
Etc
If no new values are needed for final tables/graphs, please create 2 new variables anyway
We needed to create another variable for the rate fully vaccinated. Also, for interest we will create a variable for the rate partially vaccinated. Additionally, we created a column month. 

```{r}
<<<<<<< HEAD

merged_dataset_pop_vax_new_variables <- merged_dataset_pop_vax %>%
  mutate(elg_vax_rate=(persons_fully_vaccinated/total_age12andabove)) %>%
  mutate(ovrl_vax_rate=(persons_fully_vaccinated/pop2012))
=======
#Patrick - we created month, rate, 
age12plus_la_monthly <- cov_vax_admin %>%
  select(as_of_date, county, age12_plus_population, persons_fully_vaccinated, persons_partially_vaccinated) %>%
  #this is part of cleaning - we had some zip codes with NA values in January. 
  #this may be due to the vaccine not being accessible in many zip codes at that time
  drop_na(persons_fully_vaccinated) %>%
  filter(county == "LOS ANGELES") %>%
  group_by(as_of_date) %>%
  summarize(persons_fully_vaccinated = sum(persons_fully_vaccinated),
            persons_partially_vaccinated = sum(persons_partially_vaccinated),
            age12_plus_population = sum(age12_plus_population)) %>%
  mutate(as_of_date = mdy(as_of_date)) %>%
  #this is part of cleaning as not all dates in the as_of_date field were arranged in chronological order. 
  arrange(as_of_date) %>%
  #we will create months from the as_of_date field.
  mutate(month_name = month(as_of_date, label = T)) %>%
  mutate(month = month(as_of_date, label = F))%>%
  group_by(month_name) %>%
  #after grouping by month above, we then get the cumulative total (max) for each month. 
  summarize(persons_fully_vaccinated = max(persons_fully_vaccinated), 
            persons_partially_vaccinated = max(persons_partially_vaccinated),
            age12_plus_population = max(age12_plus_population)) %>%
  #finally we add the two rate fields.
  mutate(rate_fully_vax = (persons_fully_vaccinated/age12_plus_population)*100,
         rate_part_vax = 
           (persons_partially_vaccinated/age12_plus_population)*100)

```

```{r}

#Antoinette: Combine two excel to create third variable (total age12 and above/total pop)

left_join_age12plus_lacounty <- full_join(total_age12andabove_california_county, ca_county_demographic_totalpop, by=c("county" = "name")) %>%
mutate(age12plusproportion = total_age12andabove / pop2012)

#total_age12andabove_california_county

>>>>>>> b6e797b1d8936c83a3d541fb540993d9bd9a0235
```

\newpage 

# Third Task Clean variables needed for analysis (minimum 2)
Examples
Recode invalid values
Handle missing fields
Recode categories
Etc.
If not needed for final analysis, please create at least 2 new variables anyway


```{r}
#we will change the county from all uppercase to title  
#and create the rates to percentage with 2 decimal place

cleaned_merged_dataset_pop_vax_new_variables <- 
  merged_dataset_pop_vax_new_variables %>%
  mutate(county=str_to_title(county)) %>%
  mutate(elg_vax_rate=round((elg_vax_rate) *100,2),
         ovrl_vax_rate=round((ovrl_vax_rate) *100,2))
```

\newpage 

# Forth Task: Data dictionary based on clean dataset (minimum 4 data elements), including:
Variable name
Data type
Description

Below is a data dictionary descibing all the variables used for this analysis. 
```{r}
#Patrick this is format. We will professionalize it later perhaps using kable
data_dict_age12_pl <- data.frame(
Variable_Name = c("county","total_age12andabove",
                  "persons_fully_vaccinated",
                  "pop2012",
                  "elg_vax_rate",
                  "ovrl_vax_rate"),
                            Data_Type = c("Character", rep("Double", 5)),
                            Description = c("County Name",
  "Eligble vaccinated population (12 years & above)",
  "Number of individuals that are fully vaccinated",
  "Latest census taken in year 2012",
  "Percent of eligible population that is fully vaccinated",
  "Percent of overall population that is fully vaccinated"), 
stringsAsFactors = F)

head(data_dict_age12_pl)

```

\newpage
```{r}
  #Patrick: Make this a professionally looking table
library(kableExtra)
kable(data_dict_age12_pl, format = "pipe", booktabs = T, caption = "Data
      Dictionary for COVID-19 Vaccination Rates for California from January to 
      Mid September")
```


\newpage 

# Fifth Task: One or more tables with descriptive statistics for 4 data elements
Below is the R code used for showing the number of individuals in LA county who
were fully vaccinated in January, 2021 as well as the number fully vaccinated as
of mid September (September 14, 2021). These are the minimum and maximum values derived using the summary function in R. We also used the mean function to get the average number of people vaccinated during this time period. We also got the standard deviation using R's sd function.


```{r}


#this shows the minimum number of vaccinated and max # vaccinated
#summary(age12plus_la_monthly_w_fl_mths$persons_fully_vaccinated)
#this shows the mean and standard deviation
#mean(age12plus_la_monthly_w_fl_mths$persons_fully_vaccinated)
#sd(age12plus_la_monthly_w_fl_mths$persons_fully_vaccinated)

#create a table of these descriptive statistics using these commands directly in a data.frame function.

data_table_of_descriptives <- data.frame(
  Variable_Names = c("min","max","mean","standard deviation"), 
  Persons_fully_vaccinated = c(min(cleaned_merged_dataset_pop_vax_new_variables$persons_fully_vaccinated),
  max(cleaned_merged_dataset_pop_vax_new_variables$persons_fully_vaccinated),
  mean(cleaned_merged_dataset_pop_vax_new_variables$persons_fully_vaccinated),
  sd(cleaned_merged_dataset_pop_vax_new_variables$persons_fully_vaccinated)),
  Pop_2012 = c(min(cleaned_merged_dataset_pop_vax_new_variables$pop2012),
  max(cleaned_merged_dataset_pop_vax_new_variables$pop2012),
  mean(cleaned_merged_dataset_pop_vax_new_variables$pop2012),
  sd(cleaned_merged_dataset_pop_vax_new_variables$pop2012)),
  Eligible_vax_rate = c(min(cleaned_merged_dataset_pop_vax_new_variables$elg_vax_rate),
  max(cleaned_merged_dataset_pop_vax_new_variables$elg_vax_rate),
  mean(cleaned_merged_dataset_pop_vax_new_variables$elg_vax_rate),
  sd(cleaned_merged_dataset_pop_vax_new_variables$elg_vax_rate)))

kable(data_table_of_descriptives, booktabs = T, format = "pipe", caption = 
        "This shows the minimum, maximum, mean, and standard deviation for the variables included")
  
```
From this we can see that the minimum number is 130,0878. This coincides with
 our start date in January. The maximum number of 5,913,908 coincides with 
 September.
\newpage 

#6 PDF that is professionally prepared for presentation
Each part of the milestone is clearly on one page (use \newpage to push to a new page)
Only the necessary information is outputted (you should suppress, for example, entire data frame outputs)
Use of headers and sub headers to create an organized document

